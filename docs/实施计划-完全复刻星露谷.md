# 实施计划：完全复刻《星露谷物语》（系统级复刻，内容自研/合规）

日期：2026-02-10  
仓库：`/Users/shangguanchenhuan/Documents/home2025/coke-famer`

> 说明：这里的“完全复刻”按**系统与玩法体验**对齐（机制、数值、UI/交互、节奏、内容规模），但**不直接复用原作美术/音乐/文本/角色/地名**（避免侵权）。开发阶段可用占位资源与本地参考资源验证管线，发布前必须替换为自研或可商用授权资源。

---

## 1. 现状基线（你现在已经拥有的能力）

当前仓库已具备：

- `Vite + TypeScript + Phaser 3` 可运行骨架（世界渲染、碰撞、相机、玩家移动）
- Tiled JSON 地图加载与分层（基于 `the_ville_jan7.json` 的资产管线）
- 最小交互：鼠标选格与“耕地覆盖层”演示
- 端到端测试：Playwright 验证“可加载/可移动/可点击”

关键文件：

- 游戏主场景：`src/phaser/scenes/WorldScene.ts`
- 资产同步（仅本地开发用）：`scripts/sync-ga-assets.mjs`
- 体验服务守护启动：`scripts/preview-daemon.mjs`
- E2E：`e2e/game.spec.ts`

---

## 2. 总目标拆解：复刻范围清单（对齐到 Stardew 的主要系统）

为避免范围失控，建议把“完全复刻”拆成可交付的系统清单（Workstreams），并为每个系统定义“完成标准”。

### 2.1 世界与基础体验（必须）

- 地图与场景：农场、镇子、室内、矿洞、沙漠、海滩、森林等；场景切换与传送门
- 时间与日程：日/周/季/年；昼夜；节日与事件日
- 输入与交互：键鼠 + 手柄；可配置键位；交互优先级与提示
- UI：主 HUD、快捷栏、背包、菜单、地图、日志、设置
- 存档：多存档槽、自动/手动存档、版本迁移

### 2.2 农场系统（必须）

- 地块状态：耕地/浇水/肥料/季节影响/杂草/石头/木头
- 作物：播种、生长阶段、枯萎、收获、再生作物、温室
- 工具：锄头、喷壶、斧头、镐子、镰刀；升级与能量消耗
- 树木：种植、生长、砍伐、掉落、树液/树脂等（可分阶段）
- 动物与畜棚：饲料、好感、产出、繁殖（可后置但属于“完全复刻”必达）
- 机器与加工：酿酒桶、腌菜桶、奶酪机等（产线与时间）

### 2.3 经济与物品（必须）

- 物品数据：ID/品质/堆叠/标签/用途/描述/图标/价格
- 商店与交易：购买/出售、每日库存变化、价格修正
- 制作与合成：配方解锁、制作台、消耗与产出
- 烹饪：食谱、厨房、增益状态

### 2.4 角色/NPC/关系（必须）

- NPC 日程：地点移动、室内外切换、碰撞与避让
- 对话系统：分支、条件文本（季节/天气/关系/事件）
- 好感与关系：礼物偏好、生日、恋爱/婚姻、同居行为
- 任务系统：公告板、支线任务、奖励发放
- 过场与事件：触发条件、镜头控制、脚本驱动的 cutscene

### 2.5 玩法扩展系统（完全复刻必达，但可后置）

- 钓鱼：抛竿/小游戏/鱼类/天气季节影响/宝箱
- 采矿与战斗：层数推进、怪物 AI、掉落、装备、回血/能量
- 收集与成就：博物馆捐赠、套装/社区中心等（取决于你是否要复刻该条主线）
- 多人合作：联机同步、掉线重连、存档一致性（高难度、建议最后做）

---

## 3. 技术路线总览（建议保持可演进的架构）

### 3.1 核心原则

1) **逻辑状态驱动视觉**：Tile ID 只做表现，真实状态在数据层（耕地、湿度、作物、物件等）  
2) **可序列化、可回放、可测试**：模拟层尽量纯函数/确定性，易于单测与存档  
3) **内容数据化**：作物/物品/NPC 对话/配方/日程尽量用 JSON/表驱动  
4) **渲染与模拟解耦**：update loop 分为 input → simulation tick → render sync  

### 3.2 建议的模块边界（前端单机）

- `simulation/`：时间、体力、作物 FSM、经济、掉落、任务、关系等（纯数据+规则）
- `world/`：tilemap、碰撞、实体创建、Y-sorting、摄像机、场景切换
- `ui/`：HUD、菜单、背包、对话框（DOM/UI 框架或 Phaser UI 混合）
- `content/`：物品/作物/NPC/配方/文本资源（数据文件 + loader + schema 校验）
- `save/`：存档、版本迁移、压缩（IndexedDB / 文件导入导出）

> Phaser 继续负责渲染与输入采集；复杂 UI 优先 DOM（更省时间，排版强）。

---

## 4. 里程碑计划（从现在到“完全复刻”的路径）

下面按“可交付版本”划分，每个版本都有验收标准与建议周期。周期是粗略估算，取决于人力（单人/小团队）与内容规模。

### Milestone A：MVP 农耕闭环（2–6 周）

目标：玩家在地图上完成“耕地→浇水→播种→过夜→生长→收获→入背包”的完整循环。

交付：

- Tile 交互：选格、工具使用、地块状态 Map（`x,y` → TileData）
- 作物 FSM：按天推进、阶段帧切换
- 背包与快捷栏：最简 UI（可先 DOM）
- 时间系统：日内时钟 + 睡觉跳日
- 存档 v0：本地保存/读取（至少能保存农场地块与背包）

验收标准：

- 新存档从第 1 天开始；睡觉后作物按规则成长；退出/重进状态一致

### Milestone B：工具/能量/背包完善（4–8 周）

目标：把“操作手感”和“主 UI”做出接近原作的基础体验。

交付：

- 工具系统：动画、命中范围、能量消耗、冷却
- 物品系统：品质/堆叠/描述/价格
- UI：暂停菜单、设置、背包整理、拖拽/分堆
- 音效与反馈：关键交互的音效与屏幕反馈（占位可）

验收标准：

- 玩家能连续玩 20 分钟不崩溃；背包/快捷栏操作流畅可用

### Milestone C：建造与放置、加工链（6–12 周）

目标：形成可持续的“生产与经济循环”。

交付：

- 放置物件：箱子、栅栏、地板（占位）与碰撞更新
- 机器加工：输入/输出/计时/多格占用（占位 UI）
- 商店：购买种子与材料、出售产物、价格结算

验收标准：

- 玩家能通过种植与加工获得稳定经济收益；箱子/机器状态可存档

### Milestone D：NPC 日程与对话（8–16 周）

目标：把“镇子生活感”做出来。

交付：

- NPC 导航：网格寻路（A*）、避让、室内外切换、传送点
- 日程表：按时间段切换目标地点
- 对话：条件文本、礼物、好感、生日
- 任务：简单任务链、奖励发放

验收标准：

- 至少 5 个 NPC 完整跑日程；能对话与送礼；好感变化可影响文本

### Milestone E：季节/天气/节日/事件系统（8–16 周）

目标：做出 Stardew 的“年循环节奏”。

交付：

- 季节与作物限制、天气影响（雨天自动浇水等）
- 节日与活动：场景替换、小游戏（可先占位）
- Cutscene 脚本系统：镜头、角色走位、对话、奖励

验收标准：

- 一整季可玩（28 天），节日当天能触发并完成事件

### Milestone F：钓鱼（6–10 周）

目标：复刻钓鱼小游戏手感与鱼类分布。

交付：

- 钓鱼小游戏 UI/控制
- 鱼类表：地点/季节/天气/时间
- 宝箱、鱼饵、钓竿升级（可分段）

验收标准：

- 钓鱼有成功/失败、概率与成长曲线合理；产物进背包并可出售

### Milestone G：矿洞与战斗（10–20 周）

目标：独立“战斗+探索+掉落+进度”的大系统。

交付：

- 矿洞楼层生成（固定布局或规则生成）
- 怪物 AI、攻击判定、受伤/无敌帧、装备
- 掉落与合成材料链条

验收标准：

- 从 1 层推进到 N 层有明确节奏；死亡/撤退处理与存档一致

### Milestone H：动物与牧场（8–16 周）

目标：完整畜牧链（饲养、好感、产出、加工）。

交付：

- 动物状态机（喂食、心情、产出）
- 畜棚/鸡舍系统，产物拾取与机器加工
- 牧草、围栏与开关门（可分阶段）

验收标准：

- 动物能日常产出并受照料影响；与经济系统打通

### Milestone I：多人合作（可选但“完全复刻”通常需要）（16–32 周）

目标：多人联机一致性与可玩性。

交付：

- 客户端预测/权威服务器（或锁步/状态同步）方案落地
- 物品/时间/事件同步与冲突解决
- 掉线重连、房间管理、存档托管

验收标准：

- 2–4 人能稳定同玩 1 小时，存档一致无严重回滚/复制漏洞

---

## 5. 每个里程碑的工程任务模板（可直接当 Sprint Backlog）

对每个系统建议按同一模板拆任务，便于估算与追踪：

1) 数据模型（TypeScript types + schema 校验）  
2) 规则实现（simulation，尽量无 Phaser 依赖）  
3) 渲染与交互（Phaser layer/entity）  
4) UI（DOM/Phaser UI）  
5) 存档（序列化/反序列化 + 版本迁移）  
6) 测试（单测 + E2E + 回归脚本）  
7) 性能与体验（帧率、输入延迟、内存、加载时间）  

---

## 6. 内容生产与数据化管线（决定你能否“完全复刻”）

“完全复刻”卡的往往不是代码，而是内容量。必须尽早建立内容管线：

- **Tiled 地图规范**：图层命名、tile 属性约定（collide/hoeable/waterable/trigger…）
- **数据表**：物品、作物、配方、鱼类、怪物、掉落、商店库存、NPC 日程
- **文本与本地化**：对话/任务/邮件/事件脚本（建议从一开始就支持多语言键值）
- **资源打包**：atlas/spritesheet 生成、缓存策略、懒加载
- **校验与CI**：构建时校验“数据引用的资源必须存在”“ID 唯一”“数值范围合法”

建议工具：

- JSON Schema + `zod`（运行时校验）或生成类型
- 自定义校验脚本（node）在 CI 中跑

---

## 7. 测试与质量门禁（越早越省）

建议逐步引入三类测试：

- 单元测试：simulation 规则（作物成长、经济结算、好感变化、掉落概率可控）
- 集成测试：存档读写、版本迁移、场景切换一致性
- E2E：已存在基础用例（加载/移动/点击）；后续扩展为“耕地→播种→过夜→收获”的自动化回归

质量门禁（每次合并前最低要求）：

- `npm run build` 必须通过
- `npm run e2e` 必须通过
- 关键数据表校验必须通过

---

## 8. 风险清单与应对

### 8.1 最大风险：范围与内容量

应对：

- 先做系统骨架 + 数据化管线，再铺内容
- 明确“每个系统的最小可玩版本”，避免一次性做满

### 8.2 性能风险：大地图 + 大量实体 + UI

应对：

- 分区更新（chunk）、视野裁剪（culling）
- NPC 寻路缓存与低频更新
- UI 与世界渲染解耦（DOM 优先）

### 8.3 合规风险：素材与文本

应对：

- 开发可用参考资源验证管线；发布前替换为自研/授权资源
- 文本与角色设定自研，不使用原作名称/剧情/对话

### 8.4 多人风险：复杂度指数级上升

应对：

- 单机先把“确定性模拟 + 存档一致性”做扎实
- 多人作为最后阶段，且提前确定同步模型

---

## 9. 建议的“下一步”（从现在开始的 2 周行动清单）

为了把项目从“骨架”推进到“可玩”，建议你先做下面这组任务（对应 Milestone A）：

1) 地块状态模型（tilled/moisture/cropId/stage）与序列化  
2) 作物数据表（少量作物：防风草/土豆/草莓占位）  
3) “过夜”按钮与日推进（作物阶段 + 浇水重置）  
4) 背包/快捷栏 UI（最简可用）  
5) 扩展 E2E：自动走完“耕地→播种→过夜→生长→收获”  

如果你确认“先做 Milestone A”，我可以直接按这 5 项把代码落下去，并把测试补齐。

